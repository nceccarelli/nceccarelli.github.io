{
  "version": 3,
  "sources": ["../../vanjs-core/src/van.js"],
  "sourcesContent": ["// This file consistently uses `let` keyword instead of `const` for reducing the bundle size.\n\n// Global variables - aliasing some builtin symbols to reduce the bundle size.\nlet Obj = Object, _undefined, protoOf = Obj.getPrototypeOf, doc = document\nlet changedStates, curDeps, curNewDerives, alwaysConnectedDom = {isConnected: 1}, gcCycleInMs = 1000, statesToGc, propSetterCache = {}\nlet objProto = protoOf(alwaysConnectedDom), funcProto = protoOf(protoOf)\n\nlet addAndScheduleOnFirst = (set, s, f, waitMs) =>\n  (set ?? (setTimeout(f, waitMs), new Set)).add(s)\n\nlet runAndCaptureDeps = (f, deps, arg) => {\n  let prevDeps = curDeps\n  curDeps = deps\n  try {\n    return f(arg)\n  } catch (e) {\n    console.error(e)\n    return arg\n  } finally {\n    curDeps = prevDeps\n  }\n}\n\nlet keepConnected = l => l.filter(b => b._dom?.isConnected)\n\nlet addStatesToGc = d => statesToGc = addAndScheduleOnFirst(statesToGc, d, () => {\n  for (let s of statesToGc)\n    s._bindings = keepConnected(s._bindings),\n    s._listeners = keepConnected(s._listeners)\n  statesToGc = _undefined\n}, gcCycleInMs)\n\nlet stateProto = {\n  get val() {\n    curDeps?.add(this)\n    return this._val\n  },\n\n  get oldVal() {\n    curDeps?.add(this)\n    return this._oldVal\n  },\n\n  set val(v) {\n    // Aliasing `this` to reduce the bundle size.\n    let s = this\n    if (v !== s._val) {\n      s._val = v\n      let listeners = [...s._listeners = keepConnected(s._listeners)]\n      for (let l of listeners) derive(l.f, l.s, l._dom), l._dom = _undefined\n      s._bindings.length ?\n        changedStates = addAndScheduleOnFirst(changedStates, s, updateDoms) :\n        s._oldVal = v\n    }\n  },\n}\n\nlet state = initVal => ({\n  __proto__: stateProto,\n  _val: initVal,\n  _oldVal: initVal,\n  _bindings: [],\n  _listeners: [],\n})\n\nlet isState = s => protoOf(s ?? 0) === stateProto\n\nlet val = s => isState(s) ? s.val : s\nlet oldVal = s => isState(s) ? s.oldVal : s\n\nlet bind = (f, dom) => {\n  let deps = new Set, binding = {f}, prevNewDerives = curNewDerives\n  curNewDerives = []\n  let newDom = runAndCaptureDeps(f, deps, dom)\n  newDom = (newDom ?? doc).nodeType ? newDom : new Text(newDom)\n  for (let d of deps) addStatesToGc(d), d._bindings.push(binding)\n  for (let l of curNewDerives) l._dom = newDom\n  curNewDerives = prevNewDerives\n  return binding._dom = newDom\n}\n\nlet derive = (f, s = state(), dom) => {\n  let deps = new Set, listener = {f, s}\n  listener._dom = dom ?? curNewDerives?.push(listener) ?? alwaysConnectedDom\n  s.val = runAndCaptureDeps(f, deps)\n  for (let d of deps) addStatesToGc(d), d._listeners.push(listener)\n  return s\n}\n\nlet add = (dom, ...children) => {\n  for (let c of children.flat(Infinity)) {\n    let protoOfC = protoOf(c ?? 0)\n    let child = protoOfC === stateProto ? bind(() => c.val) :\n      protoOfC === funcProto ? bind(c) : c\n    if (child != _undefined) dom.append(child)\n  }\n  return dom\n}\n\nlet _ = f => (f._isBindingFunc = 1, f)\n\nlet tagsNS = ns => new Proxy((name, ...args) => {\n  let [props, ...children] = protoOf(args[0] ?? 0) === objProto ? args : [{}, ...args]\n  let dom = ns ? doc.createElementNS(ns, name) : doc.createElement(name)\n  for (let [k, v] of Obj.entries(props)) {\n    let getPropDescriptor = proto => proto ?\n      Obj.getOwnPropertyDescriptor(proto, k) ?? getPropDescriptor(protoOf(proto)) :\n      _undefined\n    let cacheKey = name + \",\" + k\n    let propSetter = propSetterCache[cacheKey] ??\n      (propSetterCache[cacheKey] = getPropDescriptor(protoOf(dom))?.set ?? 0)\n    let setter = propSetter ? propSetter.bind(dom) : dom.setAttribute.bind(dom, k)\n    let protoOfV = protoOf(v ?? 0)\n    if (protoOfV === stateProto) bind(() => (setter(v.val), dom))\n    else if (protoOfV === funcProto && (!k.startsWith(\"on\") || v._isBindingFunc))\n      bind(() => (setter(v()), dom))\n    else setter(v)\n  }\n  return add(dom, ...children)\n}, {get: (tag, name) => tag.bind(_undefined, name)})\n\nlet update = (dom, newDom) => newDom ? newDom !== dom && dom.replaceWith(newDom) : dom.remove()\n\nlet updateDoms = () => {\n  let changedStatesArray = [...changedStates].filter(s => s._val !== s._oldVal)\n  changedStates = _undefined\n  for (let b of new Set(changedStatesArray.flatMap(s => s._bindings = keepConnected(s._bindings))))\n    update(b._dom, bind(b.f, b._dom)), b._dom = _undefined\n  for (let s of changedStatesArray) s._oldVal = s._val\n}\n\nlet hydrate = (dom, f) => update(dom, bind(f, dom))\n\nexport default {add, _, tags: tagsNS(), tagsNS, state, val, oldVal, derive, hydrate}\n"],
  "mappings": "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",
  "names": []
}
