(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();let R=Object,g,u=R.getPrototypeOf,x=document,C,d,h,k={isConnected:1},X=1e3,w,N={},Y=u(k),F=u(u),M=(t,e,n,s)=>(t??(setTimeout(n,s),new Set)).add(e),D=(t,e,n)=>{let s=d;d=e;try{return t(n)}catch(r){return console.error(r),n}finally{d=s}},O=t=>t.filter(e=>{var n;return(n=e._dom)==null?void 0:n.isConnected}),B=t=>w=M(w,t,()=>{for(let e of w)e._bindings=O(e._bindings),e._listeners=O(e._listeners);w=g},X),V={get val(){return d==null||d.add(this),this._val},get oldVal(){return d==null||d.add(this),this._oldVal},set val(t){let e=this;if(t!==e._val){e._val=t;let n=[...e._listeners=O(e._listeners)];for(let s of n)K(s.f,s.s,s._dom),s._dom=g;e._bindings.length?C=M(C,e,ne):e._oldVal=t}}},G=t=>({__proto__:V,_val:t,_oldVal:t,_bindings:[],_listeners:[]}),H=t=>u(t??0)===V,Z=t=>H(t)?t.val:t,ee=t=>H(t)?t.oldVal:t,_=(t,e)=>{let n=new Set,s={f:t},r=h;h=[];let o=D(t,n,e);o=(o??x).nodeType?o:new Text(o);for(let l of n)B(l),l._bindings.push(s);for(let l of h)l._dom=o;return h=r,s._dom=o},K=(t,e=G(),n)=>{let s=new Set,r={f:t,s:e};r._dom=n??(h==null?void 0:h.push(r))??k,e.val=D(t,s);for(let o of s)B(o),o._listeners.push(r);return e},W=(t,...e)=>{for(let n of e.flat(1/0)){let s=u(n??0),r=s===V?_(()=>n.val):s===F?_(n):n;r!=g&&t.append(r)}return t},te=t=>(t._isBindingFunc=1,t),j=t=>new Proxy((e,...n)=>{var l;let[s,...r]=u(n[0]??0)===Y?n:[{},...n],o=t?x.createElementNS(t,e):x.createElement(e);for(let[i,c]of R.entries(s)){let y=p=>p?R.getOwnPropertyDescriptor(p,i)??y(u(p)):g,v=e+","+i,b=N[v]??(N[v]=((l=y(u(o)))==null?void 0:l.set)??0),S=b?b.bind(o):o.setAttribute.bind(o,i),a=u(c??0);a===V?_(()=>(S(c.val),o)):a===F&&(!i.startsWith("on")||c._isBindingFunc)?_(()=>(S(c()),o)):S(c)}return W(o,...r)},{get:(e,n)=>e.bind(g,n)}),Q=(t,e)=>e?e!==t&&t.replaceWith(e):t.remove(),ne=()=>{let t=[...C].filter(e=>e._val!==e._oldVal);C=g;for(let e of new Set(t.flatMap(n=>n._bindings=O(n._bindings))))Q(e._dom,_(e.f,e._dom)),e._dom=g;for(let e of t)e._oldVal=e._val},re=(t,e)=>Q(t,_(e,t));const m={add:W,_:te,tags:j(),tagsNS:j,state:G,val:Z,oldVal:ee,derive:K,hydrate:re},{a:oe}=m.tags;console.log("spa.js");const U=/(:[^\/]+)/g;function se(t,e){const n=e.match(t.matcher);return n?t.params.reduce((s,r,o)=>(s[r]=decodeURIComponent(n[o+1]),s),{}):!1}function ae(t){return t.split("&").filter(e=>e.length).reduce((e,n)=>{const[s,r]=n.split("=");return e[decodeURIComponent(s)]=decodeURIComponent(r),e},{})}function le(t,e,n){const s=new RegExp(e.replace(U,"([^/]+)")+"$"),r=(e.match(U)||[]).map(o=>o.substring(1));return{name:t,path:e,handler:n,matcher:s,params:r}}const A=(t,e)=>{let n;return{route:t.find(r=>n=se(r,e)),params:n}},q=t=>{const[e,n]=t.split("?");return{path:e,queryString:n}},E=(t,e)=>t.replace(new RegExp("^"+e),"");class ie{constructor(){this.routes=[],this.prefix=""}add(e,n,s){return this.routes.push(le(e,n,s)),this}setPrefix(e){return this.prefix=e,this}dispatch(e){console.log("Router.dispatching",e);const{path:n,queryString:s}=q(E(e,this.prefix));console.log(n,s);const r=ae(s||""),{route:o,params:l}=A(this.routes,n);return o?(o.handler({params:l,query:r}),o):!1}getRoute(e){const{path:n,queryString:s}=q(E(e,this.prefix)),r=A(this.routes,n);return r&&r.route}formatUrl(e,n={},s={}){const r=this.routes.find(i=>i.name===e);if(!r)return"";const o=Object.keys(s).map(i=>[i,s[i]]).map(([i,c])=>encodeURIComponent(i)+"="+encodeURIComponent(c)).join("&"),l=this.prefix+r.path.replace(U,function(i){return n[i.substring(1)]});return o.length?l+"?"+o:l}}function ce(t,e,n){const s=m.state(""),r=a=>m.derive(()=>s.val===a),o=new ie;e.forEach(a=>{o.add(a.name,a.path,function({params:p,query:P}){console.log("VanSpa.router.action to "+a.name),s.val=a.name,a.title&&(window.document.title=a.title),a.callable().then(f=>"default"in f?t.replaceChildren(f.default(p,P)()):t.replaceChildren(f(p,P))).catch(f=>console.error("error changing page",f))})});const l=typeof n>"u"?null:n,i=m.state(l),c=()=>i.val,y=a=>{a===null?i.val=n:i.val=a};window.onpopstate=a=>{console.log("VanSpa.popstate:",a.target.location.href),o.dispatch(a.target.location.href)},window.onload=a=>{console.log("window.onload",a.target.location.href,window.history.state),y(window.history.state),o.dispatch(a.target.location.href)};const v=a=>{console.log("VanSpa.navigate",a),history.pushState(c(),"",a),o.dispatch(a)},b=a=>{a.preventDefault(),console.log("VanSpa.handleNav",a.target.href),v(a.target.href)};function S(a,...p){const{target:P,name:f,params:z,query:J,...L}=a;return console.log("VanSpa.navLink",a),oe({"aria-current":m.derive(()=>r(f).val?"page":""),href:o.formatUrl(f,z,J),target:P||"_self",role:"link",class:L.class||"router-link",onclick:b,...L},p)}return{routerElement:t,currentPage:s,router:o,navState:i,getNavState:c,setNavState:y,navigate:v,handleNav:b,isCurrentPage:r,navLink:S}}const{div:I,p:de,span:ue,hr:pe}=m.tags,fe=()=>I("Home Page"),he=t=>I("User Page",de("userId: "+t.userId)),ge=[{path:"/",name:"home",callable:async()=>fe},{path:"/user/:userId",name:"user",callable:async()=>he}],$=I({id:"layout"}),{navLink:T}=ce($,ge),me=()=>I(T({name:"home"},"Home"),ue(" | "),T({name:"user",params:{userId:123}},"User"),pe(),$);document.body.replaceChildren(me());
